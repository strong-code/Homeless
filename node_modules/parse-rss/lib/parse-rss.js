// Generated by CoffeeScript 1.6.3
module.exports = function(url, callback) {
  var FeedParser, options, request, rss;
  FeedParser = require('feedparser');
  request = require('request');
  options = {
    normalize: false,
    addmeta: true,
    feedurl: url
  };
  rss = [];
  return request(url, function(error, res, body) {
    if ((error != null) || (res != null ? res.statusCode : void 0) !== 200) {
      return callback("request:" + url + ", Error:" + error, null);
    } else {
      return request(url).pipe(new FeedParser([options])).on('error', function(error) {
        return callback(error, null);
      }).on('readable', function() {
        var item, stream;
        stream = this;
        if (item = stream.read()) {
          return rss.push(item);
        }
      }).on('end', function() {
        return callback(null, rss);
      });
    }
  });
};
